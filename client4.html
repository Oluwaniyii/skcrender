<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
</head>
<body>
    <h2>SkiteChat</h2>

    <ul id="messages"></ul>

    <div>
        <textarea name="" id="messagebox" cols="30" rows="10" placeholder="type a message">Hello</textarea>
        <br />
        <input type="text" id="receiver" placeholder="to: " />
        <button onclick="sendMessage()">send</button>
    </div>
</body>
<script>
    WebSocket.prototype.emit = function (eventName, payload) {
        this.send(JSON.stringify({ eventName, payload }));
    }
</script>
<script>
    let token =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJ1c2VyM0BnbWFpbC5jb20ifQ.iB-PnW0daAdEdzIWswUWn8Vomjs0oc3kwc7BSCaQ8pg"


    const ws = new WebSocket("ws://localhost:8383?token=" + token);

    ws.onerror = function (e) {
        console.log(e);
    }
    ws.onclose = function (e) {
        // {isTrusted: true, wasClean: true, code: 4000, reason: 'missing bearer token', type: 'close', …
        console.log(e);
    }

    function sendMessage() {
        const message = document.querySelector("#messagebox").value
        const recipient = document.querySelector("#receiver").value

        ws.emit("cl::sendMessage", {
            to: "individual",
            type: "text",
            id: recipient,
            body: message
        })
    }

    ws.onmessage = function (e) {
        console.log(e);
        const data = JSON.parse(e.data);
        console.log(data);
    };


</script>
</html>